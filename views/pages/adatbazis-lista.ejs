<%- include('../partials/header') %>

<main class="py-4">

    <% 
        // Statisztikák számítása
        let varosDb = 0;

        if (Array.isArray(varosAdatok) && varosAdatok.length > 0) {
            const egyediVarosok = new Set();
            varosAdatok.forEach(sor => {
                egyediVarosok.add(sor.varosNev);
            });
            varosDb = egyediVarosok.size;
        }
    %>

    <!-- Fejléc -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4">
        <div>
            <h1 class="h4 fw-bold mb-1">Városlista</h1>
            <p class="text-muted mb-0">
                Városok, megyék és lakosságszám adatok.
            </p>
        </div>

        <div class="d-flex flex-wrap gap-2">
            <span class="badge bg-primary">
                Összes város: <strong><%= varosDb %></strong>
            </span>
            <span class="badge bg-secondary">
                Sorok: <strong><%= varosAdatok.length %></strong>
            </span>
        </div>
    </div>

    <!-- SZŰRŐ ŰRLAP -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">
            <form class="row g-3 align-items-end" method="get" action="/adatbazis-lista">

                <div class="col-md-4">
                    <label class="form-label">Megye</label>
                    <select name="megye" class="form-select">
                        <option value="">-- Összes megye --</option>
                        <% megyeNevek.forEach(m => { %>
                            <option value="<%= m.nev %>" <%= szures.megye === m.nev ? 'selected' : '' %>>
                                <%= m.nev %>
                            </option>
                        <% }) %>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label">Város</label>
                    <select name="varos" class="form-select">
                        <option value="">-- Összes város --</option>
                        <% varosNevek.forEach(v => { %>
                            <option value="<%= v.nev %>" <%= szures.varos === v.nev ? 'selected' : '' %>>
                                <%= v.nev %>
                            </option>
                        <% }) %>
                    </select>
                </div>

                <div class="col-md-4 d-flex gap-2">
                    <button class="btn btn-primary w-100">Szűrés</button>
                    <a href="/adatbazis-lista" class="btn btn-outline-secondary">Törlés</a>
                </div>

            </form>
        </div>
    </div>

    <!-- Egyszerű keresés -->
    <div class="card shadow-sm mb-3">
        <div class="card-body">
            <label class="form-label">Keresés</label>
            <input type="text" id="search" class="form-control" placeholder="Pl.: Budapest, Baranya, 2020, 150000...">
            <small class="text-muted">A táblázat minden oszlopára keres.</small>
        </div>
    </div>

    <!-- Adattábla -->
    <div class="card shadow-sm">
        <div class="table-responsive">
            <% if (varosAdatok.length === 0) { %>

                <p class="m-3 text-muted">Nincs megjeleníthető adat.</p>

            <% } else { %>

                <table class="table table-hover align-middle mb-0" id="varos-table">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Város</th>
                            <th>Megye</th>
                            <th>Év</th>
                            <th class="text-end">Nők száma</th>
                            <th class="text-end">Összlélekszám</th>
                        </tr>
                    </thead>

                    <tbody>
                        <% varosAdatok.forEach((sor, i) => { %>
                            <tr>
                                <td><%= i + 1 %></td>
                                <td><%= sor.varosNev %></td>
                                <td><%= sor.megyeNev %></td>
                                <td><%= sor.ev || '-' %></td>
                                <td class="text-end"><%= sor.no != null ? sor.no.toLocaleString('hu-HU') : '-' %></td>
                                <td class="text-end"><%= sor.osszesen != null ? sor.osszesen.toLocaleString('hu-HU') : '-' %></td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>

            <% } %>
        </div>
    </div>

</main>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const input = document.getElementById("search");
    const rows = document.querySelectorAll("#varos-table tbody tr");

    if (!input) return;

    input.addEventListener("input", function () {
        const q = this.value.toLowerCase();
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(q) ? "" : "none";
        });
    });
});
</script>

<%- include('../partials/footer') %>
