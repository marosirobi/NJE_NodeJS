<%- include('../../partials/header') %>

<main class="py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h4 fw-bold mb-1">Város szerkesztése: <%= varos.nev %></h1>
            <p class="text-muted mb-0">Itt módosíthatja a város adatait és a hozzá tartozó népességi adatokat.</p>
        </div>
        <a href="<%= base_path %>/admin/varosok" class="btn btn-outline-secondary">
            Vissza a városokhoz
        </a>
    </div>

    <div class="row g-4">
        <!-- Város törzsadatok -->
        <div class="col-lg-5">
            <div class="card shadow-sm h-100">
                <div class="card-body p-4">
                    <h2 class="h5 fw-bold mb-3">Város adatai</h2>

                    <form action="<%= base_path %>/admin/varos/szerkeszt/<%= varos.id %>" method="POST" class="vstack gap-3">
                        <div>
                            <label for="nev" class="form-label">Város neve</label>
                            <input type="text" id="nev" name="nev" value="<%= varos.nev %>" class="form-control" required>
                        </div>
                        
                        <div>
                            <label for="megyeid" class="form-label">Megye</label>
                            <select id="megyeid" name="megyeid" class="form-select" required>
                                <% megyek.forEach(megye => { %>
                                    <option value="<%= megye.id %>" <%= (megye.id == varos.megyeid) ? 'selected' : '' %>>
                                        <%= megye.nev %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" id="megyeszekhely" name="megyeszekhely" value="1"
                                   class="form-check-input" <%= (varos.megyeszekhely) ? 'checked' : '' %>>
                            <label for="megyeszekhely" class="form-check-label">Megyeszékhely?</label>
                        </div>

                        <div class="form-check">
                            <input type="checkbox" id="megyeijogu" name="megyeijogu" value="1"
                                   class="form-check-input" <%= (varos.megyeijogu) ? 'checked' : '' %>>
                            <label for="megyeijogu" class="form-check-label">Megyei jogú város?</label>
                        </div>

                        <div class="mt-3 d-flex justify-content-end">
                            <button type="submit" class="btn btn-primary">
                                Város adatainak mentése
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Népességi adatok -->
        <div class="col-lg-7">
            <div class="card shadow-sm mb-4">
                <div class="card-body p-4">
                    <h2 class="h5 fw-bold mb-3">Új népességi adat (<%= varos.nev %>)</h2>

                    <form action="<%= base_path %>/admin/lelekszam/uj" method="POST" class="row g-3">
                        <input type="hidden" name="varosid" value="<%= varos.id %>">

                        <div class="col-md-4">
                            <label for="ev" class="form-label">Év</label>
                            <input type="number" name="ev" id="ev" class="form-control" required min="1900" max="2100">
                        </div>
                        <div class="col-md-4">
                            <label for="osszesen" class="form-label">Összesen (fő)</label>
                            <input type="number" name="osszesen" id="osszesen" class="form-control" required>
                        </div>
                        <div class="col-md-4">
                            <label for="no" class="form-label">Nők száma (fő)</label>
                            <input type="number" name="no" id="no" class="form-control" required>
                        </div>

                        <div class="col-12 d-flex justify-content-end mt-2">
                            <button type="submit" class="btn btn-primary">
                                Új népesség mentése
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <div class="card shadow-sm">
                <div class="card-body p-4">
                    <h3 class="h6 fw-bold mb-3">Meglévő népességi adatok</h3>

                    <% if (!lelekszamok || lelekszamok.length === 0) { %>
                        <p class="text-muted mb-0">
                            Ehhez a városhoz még nincs népességi adat rögzítve.
                        </p>
                    <% } else { %>
                        <div class="table-responsive">
                            <table class="table table-sm table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Év</th>
                                        <th>Összesen</th>
                                        <th>Nők</th>
                                        <th class="text-end">Műveletek</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% lelekszamok.forEach(l => { %>
                                        <tr>
                                            <td><%= l.ev %></td>
                                            <td><%= l.osszesen %> fő</td>
                                            <td><%= l.no %> fő</td>
                                            <td class="text-end">
                                                <a href="<%= base_path %>/admin/lelekszam/szerkeszt/<%= l.varosid %>/<%= l.ev %>"
                                                   class="btn btn-sm btn-outline-primary me-1">
                                                    Szerkesztés
                                                </a>
                                                <a href="<%= base_path %>/admin/lelekszam/torles/<%= l.varosid %>/<%= l.ev %>"
                                                   class="btn btn-sm btn-outline-danger"
                                                   onclick="return confirm('Biztosan törli a(z) <%= l.ev %> évi adatot?');">
                                                    Törlés
                                                </a>
                                            </td>
                                        </tr>
                                    <% }) %>
                                </tbody>
                            </table>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

</main>

<%- include('../../partials/footer') %>
